<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Задания для группы</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 512' fill='%234f46e5'><path d='M623.1 136.9l-282.7-101.2c-13.73-4.91-28.7-4.91-42.43 0L16.05 136.9C6.438 140.4 0 149.6 0 160s6.438 19.65 16.05 23.09L76.07 204.3c-11.89 15.8-20.26 34.16-24.55 53.95C40.05 263.4 32 274.8 32 288c0 9.953 4.814 18.49 11.94 24.36l-9.833 58.25c-1.727 10.24 6.922 19.39 17.17 19.39c.3125 0 .625 0 .9375-.0313c10.33-.6719 18.58-9.438 17.34-19.76l-9.773-57.95C59.16 310.9 64 300.1 64 288c0-10.2 5.1-19.53 13.34-26.44c1.1 15.48 6.005 30.52 13.51 44.05l98.65 33.66c13.73 4.91 28.7 4.91 42.43 0l280.1-101.2C633.6 179.6 640 170.4 640 160S633.6 140.4 623.1 136.9zM351.1 314.6C341.7 318.1 330.9 320 320 320c-10.92 0-21.69-1.867-32-5.51L142.8 282.1c-11.24-4.033-21.66-9.845-30.97-17.17C124.9 237.3 127.9 206.8 138.1 180.7l39.74 14.27c5.531 1.977 10.2-3.672 8.227-9.203L175.6 147.4c-1.969-5.531 3.703-10.2 9.234-8.227l39.74 14.27c26.92-16.07 59.38-21.01 90.42-13.33l-36.2 12.97c-5.531 1.977-10.2-3.672-8.227-9.203l14.27-39.74c1.969-5.531 8.203-8 12.45-5.5l91.36 52.31c4.25 2.5 5.125 8.25 1.875 12l-33.95 42.44c-3.25 3.75-9 4.25-12.75 1.125l-60.11-47.23c-24.54 5.469-46.3 20.3-59.58 41.77l78.2 28.07c5.531 1.977 10.2-3.672 8.227-9.203L279.6 171.4c-1.969-5.531 3.703-10.2 9.234-8.227l91.36 32.77c.625 3.5 .9375 7.125 .9375 10.75c0 21.47-8.422 41.81-23.71 57.34l-36.2 12.97C319.7 278.6 315 284.2 316.1 289.8L331.3 329.5C333.3 335 340.5 337.5 345.8 334.1l42.44-24.5c4.312-2.5 5.188-8.25 1.938-12l-30.05-37.56c-3.25-3.75-9-4.25-12.75-1.125l-47.23 37.05C300.1 304.2 325.2 310.2 351.1 314.6z'/></svg>">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>
<body>
    <!-- Кнопка переключения темы -->
    <button class="theme-toggle" id="themeToggle" title="Переключить тему">
        <i class="fas fa-moon"></i>
    </button>

    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <h1>Задания для группы</h1>
            </div>
            <p class="subtitle">Дедлайны, файлы и инструкции по предметам</p>
        </div>
    </header>

    <main class="container">
        <div class="stats">
            <div class="stat-card">
                <i class="fas fa-book-open"></i>
                <h3 id="totalSubjects">0</h3>
                <p>Предметов</p>
            </div>
        </div>

        <div id="subjectsGrid" class="subjects-grid">
            <!-- Карточки загружаются из data.js -->
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Загрузка заданий с GitHub...</p>
            </div>
        </div>

        <div class="info-card">
            <h3><i class="fas fa-info-circle"></i> Как пользоваться</h3>
            <ol>
                <li>Найдите предмет в списке</li>
                <li>Скачайте файлы кнопкой "Скачать"</li>
                <li>Все задания и материалы обновляются автоматически. Для получения актуальной версии обновите страницу (нажмите F5)</li>
            </ol>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4><i class="fas fa-university"></i> Учебные материалы</h4>
                    <p>Сайт создан для учебной группы</p>
                </div>
                <div class="footer-section">
                    <h4><i class="fas fa-sync-alt"></i> Актуальность</h4>
                    <p>Последнее обновление</p>
                    <p id="lastUpdate">Обновлено: <span id="currentDate"></span></p>
                </div>
            </div>
            <div class="copyright">
                <p>© 2025 Задания для группы • <a href="https://github.com/U007U/Syte" target="_blank">GitHub</a></p>
            </div>
        </div>
    </footer>

    <script src="assets/js/data.js?v=v20251203145737"></script>
    <script>
        // Основной скрипт
        document.addEventListener('DOMContentLoaded', function() {
            // Устанавливаем дату
            const now = new Date();
            document.getElementById('currentDate').textContent = 
                now.toLocaleDateString('ru-RU') + ' ' + now.toLocaleTimeString('ru-RU');
            
            // Загружаем данные предметов
            if (window.SubjectData && window.SubjectData.getSubjects) {
                renderSubjects();
            } else {
                // Ждем загрузки data.js
                setTimeout(() => {
                    if (window.SubjectData) {
                        renderSubjects();
                    } else {
                        document.getElementById('subjectsGrid').innerHTML = 
                            '<div class="error"><i class="fas fa-exclamation-triangle"></i> Не удалось загрузить данные</div>';
                    }
                }, 1000);
            }
            
            function renderSubjects() {
                const subjects = window.SubjectData.getSubjects();
                const container = document.getElementById('subjectsGrid');
                document.getElementById('totalSubjects').textContent = subjects.length;
                
                if (subjects.length === 0) {
                    container.innerHTML = '<div class="no-data">Нет предметов для отображения</div>';
                    return;
                }
                
                container.innerHTML = '';
                subjects.forEach(subject => {
                    const card = createSubjectCard(subject);
                    container.appendChild(card);
                });
            }
            
            function createSubjectCard(subject) {
                const card = document.createElement('div');
                card.className = 'subject-card';
                
                // Создаем HTML карточки
                let filesHTML = '';
                if (subject.files && subject.files.length > 0) {
                    filesHTML = '<div class="file-list">';
                    subject.files.forEach(file => {
                        filesHTML += `
                            <div class="file-item">
                                <div class="file-icon">${getFileIcon(file.filename)}</div>
                                <div class="file-info">
                                    <span class="file-name">${escapeHtml(file.name)}</span>
                                    <p class="file-desc">${escapeHtml(file.desc)}</p>
                                    <small class="file-deadline">
                                        <i class="far fa-calendar-alt"></i> 
                                        ${escapeHtml(file.deadline)}
                                    </small>
                                </div>
                                <a href="files/subjects/${encodeURIComponent(file.filename)}" 
                                   class="download-btn" 
                                   download
                                   title="Скачать файл">
                                    <i class="fas fa-download"></i>
                                </a>
                            </div>
                        `;
                    });
                    filesHTML += '</div>';
                } else {
                    filesHTML = '<p class="no-files">Нет файлов</p>';
                }
                
                card.innerHTML = `
                    <div class="subject-header">
                        <div>
                            <h3 class="subject-title">${escapeHtml(subject.name)}</h3>
                            <p class="subject-teacher">
                                <i class="fas fa-chalkboard-teacher"></i>
                                ${escapeHtml(subject.teacher)}
                            </p>
                        </div>
                        <span class="subject-badge">${subject.files ? subject.files.length : 0}</span>
                    </div>
                    ${filesHTML}
                    <div class="subject-footer">
                        <small><i class="fas fa-database"></i> Данные с GitHub</small>
                        <small><i class="fas fa-calendar-plus"></i> ${escapeHtml(subject.createdAt)}</small>
                    </div>
                `;
                
                return card;
            }
            
            function getFileIcon(filename) {
                if (!filename || filename.trim() === "") {
                    return '<i class="fas fa-file-question"></i>'; // Иконка для отсутствующего файла
                }
                const ext = filename.split('.').pop().toLowerCase();
                const icons = {
                    'jpg': 'fas fa-file-image',
                    'jpeg': 'fas fa-file-image', 
                    'png': 'fas fa-file-image',
                    'pdf': 'fas fa-file-pdf',
                    'doc': 'fas fa-file-word',
                    'docx': 'fas fa-file-word',
                    'xls': 'fas fa-file-excel',
                    'xlsx': 'fas fa-file-excel',
                    'zip': 'fas fa-file-archive',
                    'txt': 'fas fa-file-alt'
                };
                const iconClass = icons[ext] || 'fas fa-file';
                return `<i class="${iconClass}"></i>`;
            }
            
            function escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // Управление темной темой
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = themeToggle.querySelector('i');
            
            // Проверяем сохраненную тему
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
            
            // Обработчик переключения темы
            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateThemeIcon(newTheme);
                
                // Анимация кнопки
                themeToggle.style.transform = 'rotate(180deg)';
                setTimeout(() => {
                    themeToggle.style.transform = 'rotate(0deg)';
                }, 300);
            });
            
            function updateThemeIcon(theme) {
                if (theme === 'dark') {
                    themeIcon.className = 'fas fa-sun';
                    themeIcon.title = 'Включить светлую тему';
                } else {
                    themeIcon.className = 'fas fa-moon';
                    themeIcon.title = 'Включить темную тему';
                }
            }
        });
    </script>
</body>
</html>
