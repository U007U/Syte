<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Задания для группы</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎓</text></svg>">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>
<body>
    <!-- Кнопка переключения темы -->
    <button class="theme-toggle" id="themeToggle" title="Переключить тему">
        <i class="fas fa-moon"></i>
    </button>

    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <h1>Задания для группы</h1>
            </div>
            <p class="subtitle">Дедлайны, файлы и инструкции по предметам</p>
        </div>
    </header>

    <main class="container">
        <div class="stats">
            <div class="stat-card">
                <i class="fas fa-book-open"></i>
                <h3 id="totalSubjects">0</h3>
                <p>Предметов</p>
            </div>
        </div>

        <div id="subjectsGrid" class="subjects-grid">
            <!-- Карточки загружаются из data.js -->
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Загрузка заданий с GitHub...</p>
            </div>
        </div>

        <div class="info-card">
            <h3><i class="fas fa-info-circle"></i> Как пользоваться</h3>
            <ol>
                <li>Найдите предмет в списке</li>
                <li>Скачайте файлы кнопкой "Скачать"</li>
                <li>Все задания и материалы обновляются автоматически. Для получения актуальной версии обновите страницу (нажмите F5)</li>
            </ol>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4><i class="fas fa-university"></i> Учебные материалы</h4>
                    <p>Сайт создан для учебной группы</p>
                </div>
                <div class="footer-section">
                    <h4><i class="fas fa-sync-alt"></i> Актуальность</h4>
                    <p>Последнее обновление</p>
                    <p id="lastUpdate">Обновлено: <span id="currentDate"></span></p>
                </div>
            </div>
            <div class="copyright">
                <p>© 2025 Задания для группы • <a href="https://github.com/U007U/Syte" target="_blank">GitHub</a></p>
            </div>
        </div>
    </footer>

    <script src="assets/js/data.js?v=v20251203145737"></script>
    <script>
        // Основной скрипт
        document.addEventListener('DOMContentLoaded', function() {
            // Устанавливаем дату
            const now = new Date();
            document.getElementById('currentDate').textContent = 
                now.toLocaleDateString('ru-RU') + ' ' + now.toLocaleTimeString('ru-RU');
            
            // Загружаем данные предметов
            if (window.SubjectData && window.SubjectData.getSubjects) {
                renderSubjects();
            } else {
                // Ждем загрузки data.js
                setTimeout(() => {
                    if (window.SubjectData) {
                        renderSubjects();
                    } else {
                        document.getElementById('subjectsGrid').innerHTML = 
                            '<div class="error"><i class="fas fa-exclamation-triangle"></i> Не удалось загрузить данные</div>';
                    }
                }, 1000);
            }
            
            function renderSubjects() {
                const subjects = window.SubjectData.getSubjects();
                const container = document.getElementById('subjectsGrid');
                document.getElementById('totalSubjects').textContent = subjects.length;
                
                if (subjects.length === 0) {
                    container.innerHTML = '<div class="no-data">Нет предметов для отображения</div>';
                    return;
                }
                
                container.innerHTML = '';
                subjects.forEach(subject => {
                    const card = createSubjectCard(subject);
                    container.appendChild(card);
                });
            }
            
            function createSubjectCard(subject) {
                const card = document.createElement('div');
                card.className = 'subject-card';
                
                // Создаем HTML карточки
                let filesHTML = '';
                if (subject.files && subject.files.length > 0) {
                    filesHTML = '<div class="file-list">';
                    subject.files.forEach(file => {
                        filesHTML += `
                            <div class="file-item">
                                <div class="file-icon">${getFileIcon(file.filename)}</div>
                                <div class="file-info">
                                    <span class="file-name">${escapeHtml(file.name)}</span>
                                    <p class="file-desc">${escapeHtml(file.desc)}</p>
                                    <small class="file-deadline">
                                        <i class="far fa-calendar-alt"></i> 
                                        ${escapeHtml(file.deadline)}
                                    </small>
                                </div>
                                <a href="files/subjects/${encodeURIComponent(file.filename)}" 
                                   class="download-btn" 
                                   download
                                   title="Скачать файл">
                                    <i class="fas fa-download"></i>
                                </a>
                            </div>
                        `;
                    });
                    filesHTML += '</div>';
                } else {
                    filesHTML = '<p class="no-files">Нет файлов</p>';
                }
                
                card.innerHTML = `
                    <div class="subject-header">
                        <div>
                            <h3 class="subject-title">${escapeHtml(subject.name)}</h3>
                            <p class="subject-teacher">
                                <i class="fas fa-chalkboard-teacher"></i>
                                ${escapeHtml(subject.teacher)}
                            </p>
                        </div>
                        <span class="subject-badge">${subject.files ? subject.files.length : 0}</span>
                    </div>
                    ${filesHTML}
                    <div class="subject-footer">
                        <small><i class="fas fa-database"></i> Данные с GitHub</small>
                        <small><i class="fas fa-calendar-plus"></i> ${escapeHtml(subject.createdAt)}</small>
                    </div>
                `;
                
                return card;
            }
            
            function getFileIcon(filename) {
                if (!filename || filename.trim() === "") {
                    return '<i class="fas fa-file-question"></i>'; // Иконка для отсутствующего файла
                }
                const ext = filename.split('.').pop().toLowerCase();
                const icons = {
                    'jpg': 'fas fa-file-image',
                    'jpeg': 'fas fa-file-image', 
                    'png': 'fas fa-file-image',
                    'pdf': 'fas fa-file-pdf',
                    'doc': 'fas fa-file-word',
                    'docx': 'fas fa-file-word',
                    'xls': 'fas fa-file-excel',
                    'xlsx': 'fas fa-file-excel',
                    'zip': 'fas fa-file-archive',
                    'txt': 'fas fa-file-alt'
                };
                const iconClass = icons[ext] || 'fas fa-file';
                return `<i class="${iconClass}"></i>`;
            }
            
            function escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // Управление темной темой
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = themeToggle.querySelector('i');
            
            // Проверяем сохраненную тему
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
            
            // Обработчик переключения темы
            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateThemeIcon(newTheme);
                
                // Анимация кнопки
                themeToggle.style.transform = 'rotate(180deg)';
                setTimeout(() => {
                    themeToggle.style.transform = 'rotate(0deg)';
                }, 300);
            });
            
            function updateThemeIcon(theme) {
                if (theme === 'dark') {
                    themeIcon.className = 'fas fa-sun';
                    themeIcon.title = 'Включить светлую тему';
                } else {
                    themeIcon.className = 'fas fa-moon';
                    themeIcon.title = 'Включить темную тему';
                }
            }
        });
    </script>
</body>
</html>
